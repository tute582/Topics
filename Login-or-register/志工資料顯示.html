<!DOCTYPE html>
<html lang="zh-Hant"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js'></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <title>å¿—å·¥è³‡æ–™é¡¯ç¤º</title>

    <style>
      /* ======== åŸºæœ¬é é¢æ¨£å¼ ======== */
      body {
        font-family: "Arial", sans-serif;
        background: #f4f6f8; /* æ·¡ç°èƒŒæ™¯ */
        margin: 0;
        padding: 0;
      }

      /* ======== å¡ç‰‡å¤–è§€è¨­å®š ======== */
      .card {
        max-width: 720px; /* æœ€å¤§å¯¬åº¦ */
        margin: 24px auto; /* ç½®ä¸­ */
        background: #fff; /* ç™½åº• */
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08); /* é™°å½± */
        text-align: center;
      }

      h1 {
        margin: 0 0 0 0;
        font-size: 28px;
      }

      /* ======== é ­åƒæ¨£å¼ ======== */
      .avatar {
        width: 120px;
        height: 120px;
        border-radius: 50%; /* åœ“å½¢é ­åƒ */
        object-fit: cover; /* ç­‰æ¯”ä¾‹è£åˆ‡ */
        border: 3px solid #0078d4; /* è—è‰²å¤–æ¡† */
        margin-bottom: 0px;
      }

      /* ======== å€‹äººè³‡æ–™æ¸…å–® (dt/dd) ======== */
      dl {
        display: grid; /* ä½¿ç”¨gridåˆ†æˆå…©æ¬„ */
        grid-template-columns: 140px 1fr; /* å·¦æ¬„æ¨™é¡Œ å³æ¬„å…§å®¹ */
        gap: 8px 16px; /* è¡Œé–“èˆ‡æ¬„é–“è· */
        text-align: left;
        margin-top: 10px;
      }
      dt {
        font-weight: 700;
        color: #333;
      }
      dd {
        margin: 0;
        color: #222;
        word-break: break-word; /* è‡ªå‹•æ›è¡Œé˜²æ­¢æº¢å‡º */
      }

      /* ======== è¿”å›æŒ‰éˆ• ======== */
      .back {
        display: inline-block;
        margin-top: 20px;
        padding: 8px 14px;
        background: #0078d4;
        color: #fff;
        border-radius: 6px;
        text-decoration: none;
      }

      /* ä¿®æ”¹æŒ‰éˆ• */
      #editBtn{
        display: inline-block;
        margin-top: 20px;
        padding: 8px 14px;
        background: #3a3d3f;
        color: #fff;
        border-radius: 6px;
        text-decoration: none;
      }

      /* ======== ç„¡è³‡æ–™æç¤ºæ–‡å­— ======== */
      .empty {
        color: #666;
      }

      .tag-display {
        display: inline-block;
        background: #e8f5e9;
        color: #2e7d32;
        border: 1px solid #c8e6c9;
        border-radius: 12px;
        padding: 4px 10px;
        margin: 4px 6px 0 0;
        font-size: 14px;
        white-space: nowrap;
      }

      /* ======== å°è¦½åˆ—æ¨£å¼ ======== */
      .nav-1 {
        display: flex; /* æ°´å¹³æ’åˆ—å…§å®¹ */
        font-weight: bold;
        align-items: center; /* å‚ç›´ç½®ä¸­ */
        justify-content: space-between; /* å·¦å³å…©é‚Šå°é½Š */
        padding: 10px 25px;
        position: sticky; /* æ»¾å‹•æ™‚å›ºå®šé ‚ç«¯ */
        top: 0;
        z-index: 1001; /* ä¿æŒåœ¨æœ€ä¸Šå±¤ */
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        width: 100%;
        left: 0;
        right: 0;
        color: black;
        background-color: white;
        box-sizing: border-box; /* é¿å…paddingæ’çˆ† */
        border-bottom: 1px solid #ddd; /* ä¸‹é‚Šç•Œç·š */
      }
     
      /* ä¿®æ”¹modal */
      .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
        display: none;
        justify-content: center;
        align-items: center; /* è®“ modal-content å‚ç›´ç½®ä¸­ */
        z-index: 2000;
        backdrop-filter: blur(4px); 
        padding: 20px; /* å¢åŠ å››å‘¨é–“è·ï¼Œç¢ºä¿ä¸æœƒè²¼é‚Š */
        box-sizing: border-box;
      }
      
      .modal-content {
        background: #fff;
        /* margin: 40px auto;  <-- é€™ä¸€è¡Œå¯ä»¥æ‹¿æ‰ï¼Œç”± overlay çš„ padding æ§åˆ¶ */
        padding: 20px 15px;
        border-radius: 16px;
        position: relative;
        width: 90%;
        max-width: 400px; 
        box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        
        /* --- é—œéµä¿®æ”¹é» --- */
        max-height: 90vh;      /* é™åˆ¶æœ€å¤§é«˜åº¦ç‚ºè¢å¹•é«˜åº¦çš„ 90% */
        overflow-y: auto;      /* ç•¶å…§å®¹è¶…é max-height æ™‚ï¼Œè‡ªå‹•é¡¯ç¤ºå‚ç›´æ²è»¸ */
        display: flex;         /* ç¢ºä¿å…§éƒ¨æ’ç‰ˆç©©å®š */
        flex-direction: column;
      }

      .close-btn {
        position: absolute;
        top: 12px; 
        right: 12px; 
        width: 30px; 
        height: 30px; 
        background-color: #f37a7a;
        color: white;
        border-radius: 50%; 
        border: none; 
        font-size: 14px; 
        isplay: flex; 
        align-items: center; 
        ustify-content: center;
        cursor: pointer;
        z-index: 10; }
      
      
      /* modal è¡¨å–® */
      .form-section {
        max-width: 100%;      /* æ”¹ç‚º 100% é…åˆçˆ¶å®¹å™¨ */
        margin: 10px 0;       /* ç¨å¾®èª¿æ•´é–“è· */
        padding: 10px;        /* ç¸®æ¸›ä¸€äº›å…§è·ï¼ŒæŠŠç©ºé–“ç•™çµ¦å…§å®¹ */
        box-shadow: none;     /* å› ç‚ºå¤–é¢å·²ç¶“æœ‰ modal-content çš„é™°å½±äº† */
      }
      
      .form-section h3 {
        text-align: center;
        margin-bottom: 20px;
      }
      
      .form-group {
        margin-bottom: 15px;
      }
      
      .form-group label {
        display: block;
        margin-bottom: 6px;
        font-weight: 600;
        color: #333;
      }
      /* ç¢ºèªå¯¬åº¦ */
      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 88%;
        padding: 8px 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 14px;
      }
      
      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #4a90e2;
      }
      
      .btn {
        padding: 14px;
        border: none; 
        border-radius: 12px; 
        color: #fff; 
        cursor: pointer; 
        font-size: 16px; 
        width: 93%; 
        margin-top: 25px; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        gap: 8px; 
        font-weight: bold;
        background-color: #4a90e2;
      }

    </style>
  </head>
  <body>
    <!-- ======== å°è¦½åˆ—å€å¡Š ======== -->
    <nav class="nav-1">
      <div>
        <h1>å¿—å·¥å€‹äººè³‡æ–™</h1>
      </div>

      <div style="display: flex; align-items: center">
        <h1 style="margin: 0; text-align: right">
          <span class="volunteer-area" style="display: flex; align-items: center; gap: 8px">
            <!-- å°è¦½åˆ—é ­åƒï¼ˆå°å°ºå¯¸ï¼‰ -->
            <img id="volunteerAvatar" class="avatar" src="https://profile.line-scdn.net/0hKmzN9JSnFEJXNweFvphqPSdnFyh0Rk1QeFhTIWIzSiU-VFQQfgVccWplQiBqBAMQegEIdmAwTnVbJGMkSWHodlAHSXNrDlYdflBcrQ" alt="avatar" style="
                width: 40px;
                height: 40px;
                border-radius: 50%;
                object-fit: cover;
                border: 2px solid #0984e3;
              ">
            <!-- å¿—å·¥åç¨±æˆ–ç™»å…¥æç¤º -->
            <span id="volunteerName" title="é»æ­¤ä»¥ Line ç™»å…¥" style="cursor: pointer">S</span>
          </span>
        </h1>
      </div>
    </nav>

    <!-- ======== ä¸»å¡ç‰‡å…§å®¹å€ ======== -->
    <div class="card">
      <!-- å¤§é ­è²¼ï¼ˆä¸»è¦å±•ç¤ºï¼‰ -->
      <img id="avatar" class="avatar" src="https://profile.line-scdn.net/0hKmzN9JSnFEJXNweFvphqPSdnFyh0Rk1QeFhTIWIzSiU-VFQQfgVccWplQiBqBAMQegEIdmAwTnVbJGMkSWHodlAHSXNrDlYdflBcrQ" alt="ä½¿ç”¨è€…é ­åƒ">
      <!-- å¿—å·¥è©³ç´°è³‡æ–™å°‡å‹•æ…‹æ’å…¥æ­¤è™• -->
      <div id="content">
            <dl>
              <dt>å¿—å·¥ä»£ç¢¼</dt><dd>S</dd>
              <dt>å§“å</dt><dd class="edit">S</dd>
              <dt>é›»å­éƒµä»¶Email</dt><dd class="edit">S@s.com</dd>
              <dt>é€£çµ¡é›»è©±</dt><dd class="edit">0911222333</dd>
              <dt>å‡ºç”Ÿå¹´æœˆæ—¥</dt><dd class="edit">2026-01-31</dd>
              <dt>æ€§åˆ¥</dt><dd>å¥³æ€§</dd>
              <dt>åœ°å€</dt><dd class="edit">S</dd>
              <dt>ç°¡ä»‹</dt><dd class="edit">â€”</dd>

              <dt>æœå‹™ç‰¹è³ª</dt>
              <dd class="edit-t">
                
              </dd>
              <dt>ä½¿ç”¨è€…ID</dt>
              <dd> U593e97466ef378f3bf5f6f1c1190e108  <a href="https://line.me/R/share?text=U593e97466ef378f3bf5f6f1c1190e108">  <button>åˆ†äº«</button></a></dd>
            </dl>
          </div>

           
      <!-- è¿”å›åŸæœ¬é é¢æŒ‰éˆ• -->
     <div>
       <!-- <button onclick="openVolunteerModal()">ä¿®æ”¹è³‡æ–™</button> -->
       <a id="editBtn" class="edit" onclick="openVolunteerModal()">ä¿®æ”¹è³‡æ–™</a>
       <a id="backBtn" class="back" href="../../Topics/Topics/bookvolunteer/index.html">å›åˆ°åŸé é¢</a>
    </div>
     </div>

    <!-- ======== JavaScript è³‡æ–™è¼‰å…¥å€ ======== -->
    <script>
      let currentVolunteer = null;
      // å–å¾— HTML å…ƒç´ 
      const content = document.getElementById("content"); // é¡¯ç¤ºè©³ç´°è³‡æ–™çš„å®¹å™¨
      const avatarPreview = document.getElementById("avatar"); // å¡ç‰‡é ­åƒ
      const volunteerAvatar = document.getElementById("volunteerAvatar"); // å°è¦½åˆ—é ­åƒ
      const volunteerName = document.getElementById("volunteerName"); // å°è¦½åˆ—åç¨±

      // å¾ localStorage å–å¾—ä¸Šæ¬¡å„²å­˜çš„å¿—å·¥è³‡æ–™
      const userId = localStorage.getItem("userId");
      console.log("å–å¾—çš„userIdï¼š", userId);

      // é¡¯ç¤º loadingï¼ˆå¯é¸ï¼‰
      content.innerHTML = `<p>è³‡æ–™è¼‰å…¥ä¸­...</p>`;

      // å¦‚æœæ²’æœ‰ userId
      if (!userId) {
        content.innerHTML = '<p class="empty">ç›®å‰æ²’æœ‰ä»»ä½•ä½¿ç”¨è€…è³‡æ–™ã€‚</p>';
      } else {
        // ä½¿ç”¨ fetch å¾ API å–å¾—è³‡æ–™
        fetch(`https://supabase-api-six.vercel.app/volunteers/${userId}`)
          .then((res) => res.json())
          .then((result) => {
            // API å›å‚³å¤±æ•—
            if (!result.success || !result.data) {
              content.innerHTML = '<p class="empty">æ‰¾ä¸åˆ°ä½¿ç”¨è€…è³‡æ–™ã€‚</p>';
              return;
            }

            const d = result.data; // è³‡æ–™ç‰©ä»¶
            currentVolunteer = d; 

            /* ======== é ­åƒè™•ç† ======== */
            const avatarUrl =
              d.image_url && d.image_url.trim() !== ""
                ? d.image_url
                : "default-avatar.png";

            if (avatarPreview) avatarPreview.src = avatarUrl;
            if (volunteerAvatar) volunteerAvatar.src = avatarUrl;
            if (avatar) avatar.src = avatarUrl;

            /* ======== è¨­å®šåç¨± ======== */
            if (volunteerName)
              volunteerName.textContent = d.volunteer_name || "æœªç™»å…¥";

            /* ======== é¡¯ç¤ºè©³ç´°è³‡æ–™ ======== */
            const html = `
            <dl>
              <dt>å¿—å·¥ä»£ç¢¼</dt><dd>${d.vcode || ""}</dd>
              <dt>å§“å</dt><dd class="edit">${d.volunteer_name || ""}</dd>
              <dt>é›»å­éƒµä»¶Email</dt><dd class="edit">${d.email || ""}</dd>
              <dt>é€£çµ¡é›»è©±</dt><dd class="edit">${d.phone || ""}</dd>
              <dt>å‡ºç”Ÿå¹´æœˆæ—¥</dt><dd class="edit">${d.birthday || ""}</dd>
              <dt>æ€§åˆ¥</dt><dd>${d.gender || ""}</dd>
              <dt>åœ°å€</dt><dd class="edit">${d.address || ""}</dd>
              <dt>ç°¡ä»‹</dt><dd class="edit">${d.partner_experience || "â€”"}</dd>

              <dt>æœå‹™ç‰¹è³ª</dt>
              <dd class="edit-t">
                ${
                  Array.isArray(d.personality)
                    ? d.personality
                        .map((tag) => `<span class="tag-display">${tag}</span>`)
                        .join("")
                    : "â€”"
                }
              </dd>
              <dt>ä½¿ç”¨è€…ID</dt>
              <dd> ${
                d.volunteer_user_id || ""
              }  <a href='https://line.me/R/share?text=${
              d.volunteer_user_id || ""
            }'>  <button>åˆ†äº«</button></a></dd>
            </dl>
          `;

            content.innerHTML = html;
          })
          .catch((err) => {
            content.innerHTML = '<p class="empty">è³‡æ–™è®€å–å¤±æ•—ã€‚</p>';
            console.error("API Error:", err);
          });
      }

      // è®€å–å…ˆå‰å„²å­˜çš„ä¾†æºé é¢
      const fromPage = localStorage.getItem("fromPage");
      // è¨­å®šè·³è½‰é é¢
      let targetUrl = "../../Topics/Topics/bookvolunteer/index.html";
      switch (fromPage) {
        case "blood-pressure":
          targetUrl = "../../Topics/Topics/blood-pressure/index.html";
          break;
        case "bookvolunteer":
          targetUrl = "../../Topics/Topics/bookvolunteer/index.html";
          break;
        case "calendar":
          targetUrl = "../../Topics/Topics/calendar/index.html";
          break;
        case "record-information":
          targetUrl = "../../Topics/Topics/record-information/index.html";
          break;
      }

      //é»é¸è¿”å›æŒ‰éˆ•
      const backBtn = document.getElementById("backBtn");
      backBtn.href = targetUrl;

           
      //openmodal
        function openVolunteerModal() {
          if (!currentVolunteer) return;

        const modal = document.getElementById("volunteerModal");
        modal.style.display = "flex";
        const f = document.getElementById("volunteerForm");
            
      
        // å¸¶å…¥ç›®å‰è³‡æ–™
        f.volunteer_name.value = currentVolunteer.volunteer_name || "";
        f.email.value = currentVolunteer.email || "";
        f.phone.value = currentVolunteer.phone || "";
        f.birthday.value = currentVolunteer.birthday || "";
        f.address.value = currentVolunteer.address || "";
        f.partner_experience.value =
          currentVolunteer.partner_experience || "";
        const birthday = document.getElementById('birthday');
        
        birthday.max = new Date().toISOString().split('T')[0];
      }

      //close modal
      function closeVolunteerModal() {
        const modal = document.getElementById("volunteerModal");
        if (!modal) {
          console.error("æ‰¾ä¸åˆ° volunteerModal");
          return;
        }
        modal.style.display = "none";
      }


      //ä¿®æ”¹api
      document.addEventListener("DOMContentLoaded", () => {
        const form = document.getElementById("volunteerForm");
        if (!form) {
          console.error("æ‰¾ä¸åˆ° volunteerForm");
          return;
        }

        form.addEventListener("submit", async (e) => {
          e.preventDefault();
           const formData = new FormData(volunteerForm);
      
          const payload = {
            volunteer_name: formData.get("volunteer_name"),
            email: formData.get("email"),
            phone: formData.get("phone"),
            birthday: formData.get("birthday"),
            address: formData.get("address"),
            partner_experience: formData.get("partner_experience"),           
          };
      
          console.log("é€å‡º payload ğŸ‘‰", payload); // ğŸ”¥ä¸€å®šè¦çœ‹
      
         fetch(`https://supabase-api-six.vercel.app/volunteers/${userId}`, {
            method: "PATCH",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(payload),
          })
            .then(res => res.json())
            .then(result => {
              console.log("API å›å‚³ ğŸ‘‰", result);
      
              if (!result.success) {
                alert("æ›´æ–°å¤±æ•—");
                return;
              }
      
              alert("ä¿®æ”¹æˆåŠŸ âœ…");
              closeVolunteerModal();
              location.reload();
            })
            .catch(err => {
              console.error(err);
              alert("ç³»çµ±éŒ¯èª¤ "+ err);
            });
          
        });
      });



</script>
    <!-- Modal é®ç½© -->
<div id="volunteerModal" class="modal-overlay" style="display: none;;">
  <div class="modal-content">
    <button class="close-btn" onclick="closeVolunteerModal()"><i class="fas fa-times"></i></button>
    <h3 style="
    margin: 0;
    text-align: center;
">å¿—å·¥è³‡æ–™ä¿®æ”¹</h3>
    <!-- ä½ çš„åŸæœ¬è¡¨å–®ï¼Œç›´æ¥æ”¾é€²ä¾† -->
    <form id="volunteerForm" class="form-section">
           
      
      <div class="form-group" style="
    /* width: 100%; */
">
      <label class="required">å§“å</label>
      <input type="text" name="volunteer_name" required="">
      </div>
      
      <div class="form-group">
      <label class="required">é›»å­éƒµä»¶ Email</label>
      <input type="email" name="email" required="">
      </div>
      
      <div class="form-group">
      <label class="required">é€£çµ¡é›»è©±</label>
      <input type="tel" name="phone" pattern="09[0-9]{8}" required="">
      </div>
      <!-- æ¬„ä½å¾…ç¢ºèª -->
      <div class="form-group">
      <label class="required">å‡ºç”Ÿå¹´æœˆæ—¥</label>
      <input type="date" name="birthday" required="">
      </div>
      
      <div class="form-group">
      <label class="required">åœ°å€</label>
      <input type="text" name="address" required="">
      </div>
      
      <div class="form-group">
      <label>ç°¡ä»‹èˆ‡ç¶“é©—</label>
      <textarea name="partner_experience" rows="3"></textarea>
      </div>
      <!-- <div>
            tag é¸é …
      </div>  -->
      <div class="button-group">
        <button type="submit" class="btn  submit-btn" style="flex: 1;">å„²å­˜ä¿®æ”¹</button>
      </div>

    </form>
  </div>
</div>
</body>

</html>
