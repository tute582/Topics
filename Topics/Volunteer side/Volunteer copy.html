<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¿—å·¥ç®¡ç†ç³»çµ± Volunteer Dashboard</title>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <style>
      body {
        font-family: "Microsoft JhengHei", sans-serif;
        background: #f7f9fb;
        margin: 0;
        padding: 0;
        padding-bottom: 80px;
      }

      /* =========================================
         1. å°è¦½åˆ— (é‚„åŸåŸå§‹è¨­å®š)
         ========================================= */
      .nav-1 {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 25px;
        position: sticky;
        top: 0;
        z-index: 1001;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        width: 100%;
        left: 0;
        right: 0;
        color: black;
        background-color: white;
        box-sizing: border-box;
        border-bottom: 1px solid #ddd;
      }

      /* =========================================
         2. åˆ†é æŒ‰éˆ• (æ–°å¢åŠŸèƒ½)
         ========================================= */
      .tab-container {
        display: flex;
        background: white;
        margin-top: 1px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        margin-bottom: 20px;
      }
      .tab-btn {
        flex: 1;
        text-align: center;
        padding: 15px 0;
        font-size: 16px;
        font-weight: bold;
        color: #888;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: all 0.3s;
      }
      .tab-btn.active {
        color: #0984e3;
        border-bottom: 3px solid #0984e3;
        background-color: #f0f8ff;
      }
      
      .tab-content {
        display: none;
        padding: 10px 20px;
        justify-content: center;
        animation: fadeIn 0.3s ease-in-out;
      }
      .tab-content.active {
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* =========================================
         3. å¿—å·¥å¡ç‰‡ (é‚„åŸåŸå§‹æ¨£å¼)
         ========================================= */
      .card {
        width: 100%;
        max-width: 360px;
        background: #ffffff;
        border-radius: 15px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
        overflow: hidden;
        position: relative;
        margin-bottom: 20px;
      }

      .card-cover {
        width: 100%;
        height: 150px;
        background-color: #c2dfff;
      }

      .card-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        border: 3px solid rgb(94, 131, 252);
        position: absolute;
        top: 100px;
        left: 50%;
        transform: translateX(-50%);
        object-fit: cover;
        background: #fff;
      }

      .card-content {
        padding: 70px 20px 30px;
        text-align: center;
      }

      .card-title {
        font-size: 1.3em;
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
      }

      .special {
        background: #ffeaa7;
        color: #2d3436;
        padding: 2px 10px 6px;
        border-radius: 10px;
        font-size: 0.8em;
      }

      .card-tags {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 8px;
        margin-top: 8px;
      }

      .card-tags .tag {
        background-color: #e9f5ff;
        color: #007bff;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.85em;
      }

      .card-text {
        margin-top: 10px;
        color: #636e72;
        line-height: 1.5;
      }

      /* ç·¨è¼¯æ¨¡å¼çš„è¼¸å…¥æ¡†æ¨£å¼ */
      .edit-input, .edit-textarea {
        width: 90%;
        padding: 8px;
        margin: 5px 0;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 1rem;
      }
      .edit-btn {
        margin-top: 15px;
        background: #0984e3;
        color: white;
        border: none;
        padding: 8px 20px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 0.9em;
      }
      .save-btn {
        background: #00b894;
        margin-right: 10px;
      }
      .cancel-btn {
        background: #b2bec3;
      }

      /* =========================================
         4. æ—¥æ›†æ¨£å¼
         ========================================= */
      .calendar-wrapper {
        width: 100%;
        max-width: 800px;
        background-color: #fff;
        border-radius: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 20px;
        box-sizing: border-box;
      }
      /* FullCalendar å­—é«”èˆ‡æŒ‰éˆ•å¾®èª¿ */
      .fc-toolbar-title { font-size: 1.5em !important; font-weight: bold; }
      .fc-button { font-size: 0.9em !important; }
      .hospital-event {
        background-color: #d63031 !important; /* ç´…è‰²é†«é™¢ */
        border: none !important;
        color: white !important;
      }
    </style>
  </head>
  <body>

    <nav class="nav-1">
      <div>
        <h1 style="margin: 0; font-size: 28px">å¿—å·¥ç®¡ç†ç³»çµ±</h1>
      </div>
      <div style="display: flex; align-items: center">
        <h1 style="margin: 0; text-align: right">
          <span
            class="volunteer-area"
            style="display: flex; align-items: center; gap: 8px"
          >
            <img
              id="volunteerAvatar"
              class="avatar"
              src="default-avatar.png"
              alt="avatar"
              style="
                width: 40px;
                height: 40px;
                border-radius: 50%;
                object-fit: cover;
                border: 2px solid #0984e3;
              "
            />
            <span
              id="volunteerName"
              title="é»æ­¤ä»¥ Line ç™»å…¥"
              style="cursor: pointer; font-size: 26px"
              >æœªç™»å…¥</span
            >
          </span>
        </h1>
      </div>
    </nav>

    <div class="tab-container">
      <div class="tab-btn active" onclick="switchTab('info')">å¿—å·¥è³‡è¨Š</div>
      <div class="tab-btn" onclick="switchTab('calendar')">é ç´„ç´€éŒ„</div>
    </div>

    <section id="tab-info" class="tab-content active">
      <div class="card">
        <div class="card-cover"></div>
        <img class="card-avatar" src="https://i.pravatar.cc/150?img=32" alt="é ­åƒ" />
        
        <div class="card-content">
          
          <div id="viewMode">
            <h2 class="card-title">
              <span id="view-name">ç‹å°æ˜</span>
              <span id="view-special" class="special">é†«è­·è­‰ç…§</span>
            </h2>
            <div id="view-tags" class="card-tags">
              <span class="tag">è¦ªåˆ‡</span>
              <span class="tag">ç´°å¿ƒ</span>
              <span class="tag">ç†±å¿ƒåŠ©äºº</span>
            </div>
            <p id="view-text" class="card-text">æ“æœ‰è±å¯Œçš„é†«é™¢å¿—å·¥ç¶“é©—ï¼Œç†±æ„›å¹«åŠ©ä»–äººã€‚</p>
            <button class="edit-btn" onclick="toggleEdit(true)">âœï¸ ç·¨è¼¯è³‡æ–™</button>
          </div>

          <div id="editMode" style="display: none;">
            <label style="color:#888; font-size:0.8em;">å§“å</label>
            <input type="text" id="input-name" class="edit-input" value="ç‹å°æ˜">
            
            <label style="color:#888; font-size:0.8em;">ç‰¹æ®Šç¨±è™Ÿ (ä¾‹å¦‚: é†«è­·è­‰ç…§)</label>
            <input type="text" id="input-special" class="edit-input" value="é†«è­·è­‰ç…§">

            <label style="color:#888; font-size:0.8em;">æ¨™ç±¤ (ç”¨é€—è™Ÿéš”é–‹)</label>
            <input type="text" id="input-tags" class="edit-input" value="è¦ªåˆ‡, ç´°å¿ƒ, ç†±å¿ƒåŠ©äºº">

            <label style="color:#888; font-size:0.8em;">è‡ªæˆ‘ä»‹ç´¹</label>
            <textarea id="input-text" class="edit-textarea" rows="4">æ“æœ‰è±å¯Œçš„é†«é™¢å¿—å·¥ç¶“é©—ï¼Œç†±æ„›å¹«åŠ©ä»–äººã€‚</textarea>

            <div style="margin-top: 10px;">
              <button class="edit-btn save-btn" onclick="saveData()">å„²å­˜</button>
              <button class="edit-btn cancel-btn" onclick="toggleEdit(false)">å–æ¶ˆ</button>
            </div>
          </div>

        </div>
      </div>
    </section>

    <section id="tab-calendar" class="tab-content">
      <div class="calendar-wrapper">
        <div id="calendar"></div>
      </div>
    </section>

    <script>
      let calendar; 

      document.addEventListener("DOMContentLoaded", function () {
        // --- è¨­å®šæ—¥æ›† ---
        const calendarEl = document.getElementById("calendar");
        const currentYear = new Date().getFullYear(); // è‡ªå‹•æŠ“å–ä»Šå¹´å¹´ä»½

        calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: "dayGridMonth",
          initialDate: `${currentYear}-01-12`, // é è¨­è·³åˆ° 1/12
          locale: "zh-tw",
          height: 'auto',
          headerToolbar: {
            left: "prev,next",
            center: "title",
            right: "today"
          },
          events: [
            // é€™è£¡è¨­å®šæ‚¨æƒ³è¦çš„é ç´„ç´€éŒ„ç¯„ä¾‹
            {
              title: "äºæ±é†«é™¢ (é™ªä¼´å°±é†«)",
              start: `${currentYear}-01-12T10:00:00`,
              end: `${currentYear}-01-12T12:00:00`,
              classNames: ['hospital-event'], // å¥—ç”¨è‡ªè¨‚æ¨£å¼
              extendedProps: {
                location: "äºæ±é†«é™¢",
                elder: "æ—å¥¶å¥¶"
              }
            },
            {
              title: "ç¤¾å€é—œæ‡· (å®¶è¨ª)",
              start: `${currentYear}-01-20T14:00:00`,
              color: "#0984e3" // è—è‰²
            },
            {
              title: "è¡›ç”Ÿæ‰€ (æ‰“ç–«è‹—)",
              start: `${currentYear}-02-05T09:30:00`,
              color: "#00b894" // ç¶ è‰²
            }
          ],
          eventClick: function(info) {
            // é»æ“Šäº‹ä»¶é¡¯ç¤ºè©³ç´°è³‡è¨Š (ç°¡å–® alert ç¤ºç¯„)
            const props = info.event.extendedProps;
            let msg = `ğŸ“… æ™‚é–“: ${info.event.start.toLocaleString()}\nğŸ“Œ äº‹é …: ${info.event.title}`;
            if(props.location) msg += `\nğŸ¥ åœ°é»: ${props.location}`;
            if(props.elder) msg += `\nğŸ‘µ é•·è€…: ${props.elder}`;
            alert(msg);
          }
        });

        calendar.render();

        // --- åˆå§‹åŒ– LIFF (ç¶­æŒåŸå§‹é‚è¼¯) ---
        initLiffAndSetProfile();
      });

      // --- åˆ†é åˆ‡æ› (Tab) ---
      function switchTab(tabName) {
        // 1. æŒ‰éˆ•æ¨£å¼åˆ‡æ›
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        if (tabName === 'info') document.querySelectorAll('.tab-btn')[0].classList.add('active');
        if (tabName === 'calendar') document.querySelectorAll('.tab-btn')[1].classList.add('active');

        // 2. å…§å®¹é¡¯ç¤ºåˆ‡æ›
        document.querySelectorAll('.tab-content').forEach(div => div.classList.remove('active'));
        document.getElementById(`tab-${tabName}`).classList.add('active');

        // 3. ä¿®æ­£ï¼šåˆ‡æ›åˆ°æ—¥æ›†æ™‚å¼·åˆ¶æ›´æ–°å°ºå¯¸ (é¿å…ç ´åœ–)
        if (tabName === 'calendar' && calendar) {
          setTimeout(() => { calendar.updateSize(); }, 50);
        }
      }

      // --- ç·¨è¼¯åŠŸèƒ½ (Edit) ---
      function toggleEdit(showEdit) {
        if (showEdit) {
          // é€²å…¥ç·¨è¼¯æ¨¡å¼ï¼šå°‡ç›®å‰çš„æ–‡å­—å¡«å…¥è¼¸å…¥æ¡†
          document.getElementById('input-name').value = document.getElementById('view-name').innerText;
          document.getElementById('input-special').value = document.getElementById('view-special').innerText;
          document.getElementById('input-text').value = document.getElementById('view-text').innerText;
          
          // æ¨™ç±¤è™•ç†ï¼šå¾ DOM è½‰å›é€—è™Ÿå­—ä¸²
          const tags = Array.from(document.querySelectorAll('#view-tags .tag'))
                            .map(tag => tag.innerText).join(', ');
          document.getElementById('input-tags').value = tags;

          document.getElementById('viewMode').style.display = 'none';
          document.getElementById('editMode').style.display = 'block';
        } else {
          // å–æ¶ˆç·¨è¼¯
          document.getElementById('viewMode').style.display = 'block';
          document.getElementById('editMode').style.display = 'none';
        }
      }

      function saveData() {
        // 1. æ›´æ–°æ–‡å­—
        const newName = document.getElementById('input-name').value;
        const newSpecial = document.getElementById('input-special').value;
        const newText = document.getElementById('input-text').value;

        document.getElementById('view-name').innerText = newName;
        document.getElementById('view-special').innerText = newSpecial;
        document.getElementById('view-text').innerText = newText;

        // 2. æ›´æ–°æ¨™ç±¤ (å°‡é€—è™Ÿå­—ä¸²è½‰å› HTML)
        const tagsStr = document.getElementById('input-tags').value;
        const tagsArr = tagsStr.split(',').map(t => t.trim()).filter(t => t);
        const tagsContainer = document.getElementById('view-tags');
        tagsContainer.innerHTML = ''; // æ¸…ç©º
        tagsArr.forEach(tagText => {
          const span = document.createElement('span');
          span.className = 'tag';
          span.innerText = tagText;
          tagsContainer.appendChild(span);
        });

        // 3. åˆ‡æ›å›é¡¯ç¤ºæ¨¡å¼
        toggleEdit(false);
      }

      // --- LIFF (åŸå§‹é‚è¼¯) ---
      const LIFF_ID = "2008228534-R8763A2n";
      const avatarEl = document.getElementById("volunteerAvatar");
      const nameEl = document.getElementById("volunteerName");

      async function initLiffAndSetProfile() {
        try {
          await liff.init({ liffId: LIFF_ID });

          if (!liff.isLoggedIn()) {
            nameEl.innerText = "æœªç™»å…¥";
            avatarEl.style.display = "none";
            return;
          }

          const profile = await liff.getProfile();
          nameEl.innerText = profile.displayName || "å¿—å·¥";
          if (profile.pictureUrl) {
            avatarEl.src = profile.pictureUrl;
            avatarEl.style.display = "inline-block";
          } else {
            avatarEl.style.display = "none";
          }
        } catch (err) {
          console.error("LIFF init error:", err);
        }
      }

      // ç¶å®šé»æ“Šç™»å…¥äº‹ä»¶
      nameEl.addEventListener("click", () => {
        if (!liff.isLoggedIn()) {
          liff.login({ redirectUri: window.location.href });
        }
      });
    </script>
  </body>
</html>