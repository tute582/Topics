<!DOCTYPE html>
<html lang="zh-Hant">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å¿—å·¥ç®¡ç†ç³»çµ± Volunteer Dashboard</title>

    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <style>
      body {
        font-family: "Microsoft JhengHei", sans-serif;
        background: #f7f9fb;
        margin: 0;
        padding: 0;
        padding-bottom: 80px; /* é¿å…å…§å®¹è¢«åº•éƒ¨é®æ“‹ */
      }

      /* ===== å°è¦½åˆ—æ¨£å¼ ===== */
      .nav-1 {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 20px;
        position: sticky;
        top: 0;
        z-index: 1001;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
        background-color: white;
        border-bottom: 1px solid #ddd;
      }

      /* ===== åˆ†é åˆ‡æ›æŒ‰éˆ• (Tabs) ===== */
      .tab-container {
        display: flex;
        background: white;
        margin-top: 1px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
      }
      .tab-btn {
        flex: 1;
        text-align: center;
        padding: 15px 0;
        font-size: 16px;
        font-weight: bold;
        color: #888;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        transition: all 0.3s;
      }
      .tab-btn.active {
        color: #0984e3;
        border-bottom: 3px solid #0984e3;
        background-color: #f0f8ff;
      }

      /* ===== å…§å®¹å€å¡Šæ§åˆ¶ ===== */
      .tab-content {
        display: none; /* é è¨­éš±è— */
        padding: 20px;
        justify-content: center;
        animation: fadeIn 0.3s ease-in-out;
      }
      .tab-content.active {
        display: flex; /* é¡¯ç¤ºæ™‚ä½¿ç”¨ flex */
      }
      @keyframes fadeIn {
        from { opacity: 0; transform: translateY(5px); }
        to { opacity: 1; transform: translateY(0); }
      }

      /* ===== å¿—å·¥å¡ç‰‡ ===== */
      .card {
        width: 100%;
        max-width: 400px; /* æ‰‹æ©Ÿç‰ˆå¯¬åº¦ */
        background: #ffffff;
        border-radius: 15px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
        overflow: hidden;
        position: relative;
        margin: 0 auto;
      }

      .card-cover {
        width: 100%;
        height: 120px;
        background-color: #c2dfff;
      }

      .card-avatar {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        border: 4px solid white;
        position: absolute;
        top: 70px;
        left: 50%;
        transform: translateX(-50%);
        object-fit: cover;
        background: #fff;
      }

      .card-content {
        padding: 60px 20px 30px;
        text-align: center;
      }

      .card-title {
        font-size: 1.5em;
        margin: 10px 0;
        color: #333;
      }

      .special {
        background: #ffeaa7;
        color: #2d3436;
        padding: 2px 10px 4px;
        border-radius: 10px;
        font-size: 0.6em;
        vertical-align: middle;
        margin-left: 5px;
      }

      .card-text {
        color: #636e72;
        line-height: 1.6;
        margin: 15px 0;
      }

      .info-row {
        text-align: left;
        margin-bottom: 10px;
        padding: 8px;
        background: #f9f9f9;
        border-radius: 8px;
        font-size: 0.95em;
      }
      .info-label {
        font-weight: bold;
        color: #0984e3;
        margin-right: 5px;
      }

      /* ç·¨è¼¯æ¨¡å¼æ¨£å¼ */
      .edit-input {
        width: 90%;
        padding: 6px;
        border: 1px solid #ccc;
        border-radius: 4px;
        font-size: 1em;
        margin-top: 5px;
      }
      .edit-textarea {
        width: 90%;
        height: 80px;
        padding: 6px;
        border: 1px solid #ccc;
        border-radius: 4px;
        resize: none;
        font-size: 1em;
        margin-top: 5px;
      }
      .action-btn {
        width: 100%;
        padding: 12px;
        border: none;
        border-radius: 8px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 10px;
        transition: background 0.2s;
      }
      .btn-edit { background: #0984e3; color: white; }
      .btn-save { background: #00b894; color: white; display: none; } /* é è¨­éš±è—å„²å­˜éˆ• */

      /* ===== æ—¥æ›†å®¹å™¨ ===== */
      .calendar-wrapper {
        width: 100%;
        max-width: 800px;
        background-color: #fff;
        border-radius: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        padding: 15px;
        margin-bottom: 20px;
      }

      /* FullCalendar æ¨£å¼å¾®èª¿ */
      .fc-toolbar-title { font-size: 1.2em !important; }
      .fc-event { cursor: pointer; }
      
      /* è‡ªè¨‚äº‹ä»¶æ¨£å¼ */
      .hospital-event {
        background-color: #e74c3c !important; /* ç´…è‰²ç³»ä»£è¡¨é†«é™¢ */
        border: none !important;
        color: white !important;
        padding: 2px 4px;
        border-radius: 4px;
      }

    </style>
  </head>
  <body>

    <nav class="nav-1">
      <div style="font-size: 20px; font-weight: bold;">å¿—å·¥ç®¡ç†ç³»çµ±</div>
      <div style="display: flex; align-items: center; gap: 8px;">
        <img id="volunteerAvatar" src="https://via.placeholder.com/40" style="width:36px;height:36px;border-radius:50%;display:none;">
        <span id="volunteerName" style="font-size:14px; color:#555;">è¼‰å…¥ä¸­...</span>
      </div>
    </nav>

    <div class="tab-container">
      <div class="tab-btn active" onclick="switchTab('info')">å¿—å·¥è³‡è¨Š</div>
      <div class="tab-btn" onclick="switchTab('calendar')">é ç´„ç´€éŒ„</div>
    </div>

    <section id="tab-info" class="tab-content active">
      <div class="card">
        <div class="card-cover"></div>
        <img class="card-avatar" src="https://i.pravatar.cc/150?img=32" alt="é ­åƒ" />
        
        <div class="card-content">
          <div id="viewMode">
            <h2 class="card-title">
              <span id="display-name">ç‹å°æ˜</span>
              <span class="special">å¿—å·¥ç·¨è™Ÿ: V-001</span>
            </h2>
            <div class="info-row">
              <span class="info-label">è¯çµ¡é›»è©±:</span>
              <span id="display-phone">0912-345-678</span>
            </div>
            <div class="info-row">
              <span class="info-label">å°ˆé•·/è­‰ç…§:</span>
              <span id="display-skill">åŸºæœ¬æ•‘å‘½è¡“(BLS), é™ªä¼´ç…§è­·</span>
            </div>
            <div class="info-row">
              <span class="info-label">æœå‹™åœ°å€:</span>
              <span id="display-area">æ–°åŒ—å¸‚æ¿æ©‹å€</span>
            </div>
            <p class="card-text" id="display-bio">
              æ“æœ‰è±å¯Œçš„é†«é™¢å¿—å·¥ç¶“é©—ï¼Œç†±æ„›å¹«åŠ©ä»–äººï¼Œé€±æœ«æ™‚é–“è¼ƒç‚ºå½ˆæ€§ã€‚
            </p>
            <button class="action-btn btn-edit" onclick="toggleEdit(true)">âœï¸ ç·¨è¼¯è³‡æ–™</button>
          </div>

          <div id="editMode" style="display: none; text-align: left;">
            <label>å§“å</label>
            <input type="text" id="edit-name" class="edit-input" value="ç‹å°æ˜">
            
            <label style="margin-top:10px;display:block;">é›»è©±</label>
            <input type="tel" id="edit-phone" class="edit-input" value="0912-345-678">

            <label style="margin-top:10px;display:block;">å°ˆé•·/è­‰ç…§</label>
            <input type="text" id="edit-skill" class="edit-input" value="åŸºæœ¬æ•‘å‘½è¡“(BLS), é™ªä¼´ç…§è­·">

            <label style="margin-top:10px;display:block;">æœå‹™åœ°å€</label>
            <input type="text" id="edit-area" class="edit-input" value="æ–°åŒ—å¸‚æ¿æ©‹å€">

            <label style="margin-top:10px;display:block;">è‡ªæˆ‘ä»‹ç´¹</label>
            <textarea id="edit-bio" class="edit-textarea">æ“æœ‰è±å¯Œçš„é†«é™¢å¿—å·¥ç¶“é©—ï¼Œç†±æ„›å¹«åŠ©ä»–äººï¼Œé€±æœ«æ™‚é–“è¼ƒç‚ºå½ˆæ€§ã€‚</textarea>

            <button class="action-btn btn-save" style="display:block; margin-top:20px;" onclick="saveProfile()">ğŸ’¾ å„²å­˜ä¿®æ”¹</button>
            <button class="action-btn" style="background:#aaa; color:white; margin-top:10px;" onclick="toggleEdit(false)">å–æ¶ˆ</button>
          </div>

        </div>
      </div>
    </section>

    <section id="tab-calendar" class="tab-content">
      <div class="calendar-wrapper">
        <div style="background:#e3f2fd; color:#0d47a1; padding:10px; border-radius:8px; margin-bottom:15px; font-size:0.9em;">
          â„¹ï¸ ä»¥ä¸‹é¡¯ç¤ºæ‚¨çš„æ­·å²é ç´„èˆ‡æœªä¾†è¡Œç¨‹ã€‚é»æ“Šæ—¥æœŸå¯æŸ¥çœ‹è©³ç´°è³‡è¨Šã€‚
        </div>
        <div id="calendar"></div>
      </div>
    </section>

    <script>
      let calendar; // å…¨åŸŸè®Šæ•¸ï¼Œè®“åˆ‡æ›åˆ†é æ™‚å¯ä»¥å‘¼å«

      document.addEventListener("DOMContentLoaded", function () {
        // --- åˆå§‹åŒ– FullCalendar ---
        const calendarEl = document.getElementById("calendar");
        
        // å–å¾—ç›®å‰çš„å¹´ä»½ï¼Œè®“ç¯„ä¾‹è³‡æ–™é¡¯ç¤ºåœ¨ç•¶å‰å¹´ä»½çš„1æœˆ12æ—¥ï¼Œé¿å…çœ‹ä¸åˆ°
        const currentYear = new Date().getFullYear();

        calendar = new FullCalendar.Calendar(calendarEl, {
          initialView: "dayGridMonth",
          // é è¨­æ—¥æœŸè¨­ç‚ºç•¶å¹´åº¦ 1æœˆï¼Œæ–¹ä¾¿çœ‹åˆ°ç¯„ä¾‹
          initialDate: `${currentYear}-01-12`, 
          locale: "zh-tw",
          headerToolbar: {
            left: "prev,next",
            center: "title",
            right: "today"
          },
          height: 'auto', // è‡ªé©æ‡‰é«˜åº¦
          events: [
            // é€™è£¡è¨­å®šæ‚¨æƒ³è¦çš„é ç´„ç´€éŒ„ç¯„ä¾‹
            {
              title: "äºæ±é†«é™¢ (é™ªä¼´å°±é†«)",
              start: `${currentYear}-01-12T10:00:00`,
              end: `${currentYear}-01-12T12:00:00`,
              classNames: ['hospital-event'], // å¥—ç”¨è‡ªè¨‚æ¨£å¼
              extendedProps: {
                location: "äºæ±é†«é™¢",
                elder: "æ—å¥¶å¥¶"
              }
            },
            {
              title: "ç¤¾å€é—œæ‡· (å®¶è¨ª)",
              start: `${currentYear}-01-20T14:00:00`,
              color: "#0984e3" // è—è‰²
            },
            {
              title: "è¡›ç”Ÿæ‰€ (æ‰“ç–«è‹—)",
              start: `${currentYear}-02-05T09:30:00`,
              color: "#00b894" // ç¶ è‰²
            }
          ],
          eventClick: function(info) {
            // é»æ“Šäº‹ä»¶é¡¯ç¤ºè©³ç´°è³‡è¨Š (ç°¡å–® alert ç¤ºç¯„)
            const props = info.event.extendedProps;
            let msg = `ğŸ“… æ™‚é–“: ${info.event.start.toLocaleString()}\nğŸ“Œ äº‹é …: ${info.event.title}`;
            if(props.location) msg += `\nğŸ¥ åœ°é»: ${props.location}`;
            if(props.elder) msg += `\nğŸ‘µ é•·è€…: ${props.elder}`;
            alert(msg);
          }
        });

        calendar.render();
        
        // åˆå§‹åŒ– LIFF
        initLiff();
      });

      // --- åˆ†é åˆ‡æ›é‚è¼¯ ---
      function switchTab(tabName) {
        // 1. è™•ç†æŒ‰éˆ•æ¨£å¼
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        // æ‰¾å‡ºè¢«é»æ“Šçš„æŒ‰éˆ•ä¸¦åŠ ä¸Š active (é€™è£¡ç°¡å–®ç”¨ onclick è§¸ç™¼çš„ä½ç½®åˆ¤æ–·ï¼Œæˆ–ç›´æ¥æŒ‡å®š)
        if(tabName === 'info') document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
        if(tabName === 'calendar') document.querySelector('.tab-btn:nth-child(2)').classList.add('active');

        // 2. è™•ç†å…§å®¹é¡¯ç¤º
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
        document.getElementById(`tab-${tabName}`).classList.add('active');

        // 3. ç‰¹æ®Šè™•ç†ï¼šå¦‚æœæ˜¯åˆ‡æ›åˆ°æ—¥æ›†ï¼Œå¿…é ˆé‡æ–° renderï¼Œå¦å‰‡å¯¬é«˜æœƒè·‘æ‰
        if (tabName === 'calendar' && calendar) {
          setTimeout(() => {
            calendar.updateSize(); // é‡æ–°è¨ˆç®—å°ºå¯¸
          }, 50); // ç¨å¾®å»¶é²ç¢ºä¿ DOM å·²é¡¯ç¤º
        }
      }

      // --- å¿—å·¥è³‡æ–™ç·¨è¼¯é‚è¼¯ ---
      function toggleEdit(isEdit) {
        const viewMode = document.getElementById('viewMode');
        const editMode = document.getElementById('editMode');

        if (isEdit) {
          viewMode.style.display = 'none';
          editMode.style.display = 'block';
          // æŠŠé¡¯ç¤ºçš„å€¼å¸¶å…¥è¼¸å…¥æ¡†
          document.getElementById('edit-name').value = document.getElementById('display-name').innerText;
          // å…¶ä»–æ¬„ä½ä¾æ­¤é¡æ¨...
        } else {
          viewMode.style.display = 'block';
          editMode.style.display = 'none';
        }
      }

      function saveProfile() {
        // 1. å–å¾—è¼¸å…¥æ¡†çš„å€¼
        const newName = document.getElementById('edit-name').value;
        const newPhone = document.getElementById('edit-phone').value;
        const newSkill = document.getElementById('edit-skill').value;
        const newArea = document.getElementById('edit-area').value;
        const newBio = document.getElementById('edit-bio').value;

        // 2. æ›´æ–°é¡¯ç¤ºç•«é¢
        document.getElementById('display-name').innerText = newName;
        document.getElementById('display-phone').innerText = newPhone;
        document.getElementById('display-skill').innerText = newSkill;
        document.getElementById('display-area').innerText = newArea;
        document.getElementById('display-bio').innerText = newBio;

        // 3. é—œé–‰ç·¨è¼¯æ¨¡å¼
        toggleEdit(false);

        // 4. (é¸ç”¨) é€™è£¡å¯ä»¥åŠ å…¥é€å¾Œç«¯ API æˆ–å­˜ localStorage çš„ç¨‹å¼ç¢¼
        alert("âœ… è³‡æ–™å·²æ›´æ–°ï¼");
      }

      // --- LIFF ç›¸é—œ (ä¿ç•™æ‚¨åŸæœ¬çš„é‚è¼¯) ---
      const LIFF_ID = "2008228534-R8763A2n"; 
      async function initLiff() {
        try {
          await liff.init({ liffId: LIFF_ID });
          if (liff.isLoggedIn()) {
            const profile = await liff.getProfile();
            document.getElementById("volunteerName").innerText = profile.displayName;
            const img = document.getElementById("volunteerAvatar");
            if (profile.pictureUrl) {
                img.src = profile.pictureUrl;
                img.style.display = "block";
            }
          } else {
            document.getElementById("volunteerName").innerText = "æœªç™»å…¥ (é»æ­¤ç™»å…¥)";
            document.getElementById("volunteerName").style.cursor = "pointer";
            document.getElementById("volunteerName").onclick = () => {
                liff.login({ redirectUri: window.location.href });
            };
          }
        } catch (err) {
          console.error("LIFF error:", err);
        }
      }
    </script>
  </body>
</html>